<?php
/*!*
* @author Sir Xiradorn - http://xiradorn.it
*
* @package XirCookie Enhance Mod functions
* @version 1.0.0
* @copyright (c) 2015 Xiradorn Lab
* @license http://opensource.org/licenses/gpl-license.php GNU Public License
*
*/
 function xir_cookie_set($activator){$accetto='Accetto';if($activator===$accetto){$xir_cookie_name='xir_cookie_choise';$xir_cookie_val='Accetto';$xir_cookie_time=time()+31536000;setcookie($xir_cookie_name,$xir_cookie_val,$xir_cookie_time);}}function xir_cookie_autolang($xir_lang_default_detected='it',$xir_lang_force_detected='it'){global $user,$phpbb_root_path,$phpEx;$xir_lang_default_string='';$xir_lang_force_check='';$lang_handler=$_SERVER['HTTP_ACCEPT_LANGUAGE'];$xir_cookie_force_check=(isset($_GET['xiforce']))?$_GET['xiforce']:null;$xir_cookie_force_lang=(isset($_GET['xilang']))?$_GET['xilang']:null;if(isset($xir_cookie_force_check)){$xir_lang_force_check='yes';}include("xir_cookie_allowed_lang.$phpEx");$xir_langs_list_string=implode(', ',$xir_langs_list);foreach($xir_langs_list as $flang=>$flang_str){if(isset($lang_handler)){$xir_lang_default_detected=substr($lang_handler,0,2);if($xir_lang_default_detected==$flang){$xir_flags_big_class="xir_flag_big_img xir_flag_big_img_browser";}else{$xir_flags_big_class="xir_flag_big_img";}if($xir_cookie_force_lang==$flang and $xir_lang_force_check=='yes'){$xir_flags_big_class.=" xir_flag_big_img_force";}}$xir_current_page_ext=substr($user->page['page_name'],0,-4);if($xir_current_page_ext=='xir_cookie'){$list_flags[$flang]="<a class=\"xir_flag_img\" href=\"{$phpbb_root_path}xir_cookie.$phpEx?xiforce=yes&amp;xilang={$flang}\" alt=\"$flang_str\"><img src=\"{$phpbb_root_path}images/xir_flags/".$flang.".png\" title=\"$flang_str\" /></a>";$list_flags_big[$flang]="<a class=\"{$xir_flags_big_class}\" href=\"{$phpbb_root_path}xir_cookie.$phpEx?xiforce=yes&amp;xilang={$flang}\" alt=\"$flang_str\"><img src=\"{$phpbb_root_path}images/xir_flags_big/".$flang.".jpg\" title=\"$flang_str\" /></a>";}else{$list_flags[$flang]="<a class=\"xir_flag_img\" href=\"{$phpbb_root_path}index.$phpEx?xiforce=yes&amp;xilang={$flang}\" alt=\"$flang_str\"><img src=\"{$phpbb_root_path}images/xir_flags/".$flang.".png\" title=\"$flang_str\" /></a>";$list_flags_big[$flang]="<a class=\"{$xir_flags_big_class}\" href=\"{$phpbb_root_path}index.$phpEx?xiforce=yes&amp;xilang={$flang}\" alt=\"$flang_str\"><img src=\"{$phpbb_root_path}images/xir_flags_big/".$flang.".jpg\" title=\"$flang_str\" /></a>";}}$xir_list_flags_str=implode(" ",$list_flags);$xir_list_flags_big_str=implode(" ",$list_flags_big);if(isset($lang_handler)){$xir_lang_default_detected=substr($lang_handler,0,2);foreach($xir_langs_list as $lang=>$lang_string){if($xir_lang_default_detected==$lang and $xir_lang_force_check==''){$_x_str=xir_cookie_file_lang($user->lang_path,$lang);$xir_lang_default_id=$xir_lang_default_detected;$xir_lang_default_string="{$_x_str['X_AUTO_LANG_STRING_LIST']}";$xir_lang_default_string.="{$xir_list_flags_str}.";$xir_lang_default_string.="<br/>{$_x_str['X_AUTO_LANG_STRING_CURRENT']}";$xir_lang_default_string.=sprintf($_x_str{'X_AUTO_LANG_STRING_CURRENT_FLAG'},$list_flags[$lang],$lang_string);}elseif($xir_cookie_force_lang==$lang and $xir_lang_force_check=='yes'){$lang_browser=$xir_lang_default_detected;$lang=$xir_cookie_force_lang;$xir_lang_default_detected=$lang;$_x_str=xir_cookie_file_lang($user->lang_path,$lang);$xir_lang_default_id=$xir_cookie_force_lang;$xir_lang_default_string="{$_x_str['X_AUTO_LANG_STRING_LIST']}";$xir_lang_default_string.="{$xir_list_flags_str}.";$xir_lang_default_string.="<br/>{$_x_str['X_AUTO_LANG_STRING_CURRENT']}";$xir_lang_default_string.=sprintf($_x_str{'X_AUTO_LANG_STRING_CURRENT_FLAG'},$list_flags[$lang_browser],$xir_langs_list[$lang_browser]);$xir_lang_default_string.="<br />{$_x_str['X_AUTO_LANG_STRING_FORCE']}";$xir_lang_default_string.=sprintf($_x_str{'X_AUTO_LANG_STRING_FORCE_FLAG'},$list_flags[$lang],$xir_langs_list[$lang]);}}}return array('id'=>$xir_lang_default_id,'default'=>$xir_lang_default_string,'list'=>$xir_langs_list,'list_flags'=>$list_flags,'list_flags_big'=>$list_flags_big,'list_flags_str'=>$xir_list_flags_str,'list_flags_big_str'=>$xir_list_flags_big_str,'detected_lang'=>$xir_lang_default_detected);}function xir_cookie_autolang_recog($xir_lang_default_detected='it',$xir_lang_force_detected='it'){global $user,$phpbb_root_path,$phpEx;$xir_lang_default_string='';$xir_lang_force_check='';$lang_handler=$_SERVER['HTTP_ACCEPT_LANGUAGE'];$xir_cookie_force_check=(isset($_GET['xiforce']))?$_GET['xiforce']:null;$xir_cookie_force_lang=(isset($_GET['xilang']))?$_GET['xilang']:null;if(isset($xir_cookie_force_check)){$xir_lang_force_check='yes';}include("xir_cookie_allowed_lang.$phpEx");$xir_langs_list_string=implode(', ',$xir_langs_list);if(isset($lang_handler)){$xir_lang_default_detected=substr($lang_handler,0,2);foreach($xir_langs_list as $lang=>$lang_string){if($xir_lang_default_detected==$lang and $xir_lang_force_check==''){$_x_str=xir_cookie_file_lang($user->lang_path,$lang);$xir_lang_default_id=$xir_lang_default_detected;}elseif($xir_cookie_force_lang==$lang and $xir_lang_force_check=='yes'){$lang=$xir_cookie_force_lang;$xir_lang_default_detected=$lang;$_x_str=xir_cookie_file_lang($user->lang_path,$lang);$xir_lang_default_id=$xir_cookie_force_lang;}}}return $xir_lang_default_id;}function xir_cookie_file_lang($lang_path,$lang){global $phpEx;$lang_file_path="{$lang_path}{$lang}/xir_cookie_mod/xir_cookie_mod.$phpEx";include($lang_file_path);return $xir_cookie_common_lang;}function xir_cookie_eurlex(){global $user,$phpbb_root_path,$phpEx;$x_lang_id=xir_cookie_autolang_recog();$_x_str=xir_cookie_file_lang($user->lang_path,$x_lang_id);$lex_lang_id=array("it","en","de","fr","el","es",);$lex_img_html="{$phpbb_root_path}images/xir_icon/html_file.png";$lex_img_pdf="{$phpbb_root_path}images/xir_icon/pdf_file.png";$lex_url_html_title=$lex_url_pdf_title=$_x_str['X_EURLEX_URL_TITLE'];if(in_array($x_lang_id,$lex_lang_id)){$lex_url_html="{$phpbb_root_path}docs/xir_cookie_mod_eurlex/CELEX-32002L0058-".strtoupper($x_lang_id)."-TXT.html";$lex_url_pdf="{$phpbb_root_path}docs/xir_cookie_mod_eurlex/CELEX-32002L0058-".strtoupper($x_lang_id)."-TXT.pdf";}else{$lex_url_html="{$phpbb_root_path}docs/xir_cookie_mod_eurlex/CELEX-32002L0058-EN-TXT.html";$lex_url_pdf="{$phpbb_root_path}docs/xir_cookie_mod_eurlex/CELEX-32002L0058-EN-TXT.pdf";}$lex_msg=sprintf($_x_str['X_EURLEX_WIDGET'],$lex_url_html_title,$lex_url_html,$lex_img_html,$lex_url_pdf_title,$lex_url_pdf,$lex_img_pdf);return $lex_msg;}function xir_cookie_copyright($hash){global $user,$phpbb_root_path,$phpEx;include("{$phpbb_root_path}includes/xir_cookie_mod/191bfc286713f2625898748faae7145e.$phpEx");$_x_copy=$_x_c_str['X_XIR_COOKIE_COPY'];$_x_error=$_x_c_str['X_XIR_COOKIE_COPY_ERROR'];$check_code=(string) md5($_x_copy);if(!isset($_x_copy)or $check_code!=$hash){trigger_error($_x_error);}$actual_style_template_path=(isset($user->theme['template_inherit_path'])&&$user->theme['template_inherit_path'])?"{$phpbb_root_path}styles/".rawurlencode($user->theme['template_inherit_path']).'/template':"{$phpbb_root_path}styles/".rawurlencode($user->theme['template_path']).'/template';$footer_path=$actual_style_template_path."/overall_footer.html";$check_footer=file_get_contents($footer_path);$mod_pattern='#{L_XIR_COOKIE_COPY}#';$copy_pattern='#<!-- IF S_XIR_COOKIE_MOD -->#';$mod_check=preg_match($mod_pattern,$check_footer);$copy_check=preg_match($copy_pattern,$check_footer);if(!isset($mod_check)or $mod_check==false){trigger_error($_x_error,E_USER_ERROR);}if(!isset($copy_check)or $copy_check==false){trigger_error($_x_error,E_USER_ERROR);}return array('copy'=>$_x_copy,'error'=>$_x_error,);}function xif_ext_lang($lang_path,$lang){global $phpEx;$lang_file_path="{$lang_path}{$lang}/xir_cookie_mod/xif_ext_lang.$phpEx";include($lang_file_path);return $xif_ext_common_lang;}function xfx_img_resizer($width,$height,$new_width=120,$new_height=120,$resize_force=false){if($width>$new_width||$height>$new_height||$resize_force=true){if($width>=$height){$final_width=$new_width;$final_height=round(($height*$new_height)/$width);}elseif($height>$width){$final_height=$new_height;$final_width=round(($width*$new_height)/$height);}}else{$final_width=$width;$final_height=$height;}return array('res_width'=>$final_width,'res_height'=>$final_height,);}function xif_user_avatar($x_w_new=120,$x_h_new=120){global $user,$phpbb_root_path,$phpEx;$xf_lang=xir_cookie_autolang_recog();$_xf_str=xif_ext_lang($user->lang_path,$xf_lang);$_xf_avatar_guest=$_xf_str['XIF_OSPITE'];$x_cookie=(isset($_COOKIE['xir_cookie_choise']))?$_COOKIE['xir_cookie_choise']:null;if($user->data['is_registered']&&!$user->data['is_bot']){$x_avatar=$user->data['user_avatar'];$x_avatar_w=$user->data['user_avatar_width'];$x_avatar_h=$user->data['user_avatar_height'];$x_avatar_t=$user->data['user_avatar_type'];if($x_avatar_w!=0||$x_avatar_h!=0){$xrcl_img_res=xfx_img_resizer($x_avatar_w,$x_avatar_h,$x_w_new,$x_h_new);$x_avatar_w=$xrcl_img_res['res_width'];$x_avatar_h=$xrcl_img_res['res_height'];}if(!function_exists('get_user_avatar')){include_once("{$phpbb_root_path}includes/functions_display.$phpEx");}$xir_user_avatar=get_user_avatar($x_avatar,$x_avatar_t,$x_avatar_w,$x_avatar_h);}elseif(!isset($x_cookie)){$xir_user_avatar='<img data-src="holder.js/'.$x_w_new.'x'.$x_h_new.'?fg=ffffff&amp;theme=lava&amp;text=X&amp;size=6" style="margin: 10px auto; border-radius: 5px">';}else{$xir_user_avatar='<img data-src="holder.js/'.$x_w_new.'x'.$x_h_new.'?bg=333366&amp;fg=ffffff&amp;text='.$_xf_avatar_guest.'&amp;size=8" style="margin: 10px auto; border-radius: 5px">';}return $xir_user_avatar;}function xif_user_info(){global $user,$phpbb_root_path,$phpEx;$xf_lang=xir_cookie_autolang_recog();$_xf_str=xif_ext_lang($user->lang_path,$xf_lang);$x_cookie=(isset($_COOKIE['xir_cookie_choise']))?$_COOKIE['xir_cookie_choise']:null;if($user->data['is_registered']&&!$user->data['is_bot']){$x_usermode="full";$x_username=$user->data['username'];$x_userid=$user->data['user_id'];$x_usercolor=$user->data['user_colour'];$xif_user_name=get_username_string($x_usermode,$x_userid,$x_username,$x_usercolor);}elseif(!isset($x_cookie)){$xif_user_name="Cookie Policy Bot";}else{$xif_user_name=$_xf_str['XIF_OSPITE'];}if($user->data['is_registered']&&!$user->data['is_bot']){$x_userrank=$user->data['user_rank'];$x_userposts=$user->data['user_posts'];$x_ranktitle="";$x_rankimg="";$x_ranksrc="";get_user_rank($x_userrank,$x_userposts,$x_ranktitle,$x_rankimg,$x_ranksrc);$xif_user_rank="{$x_ranktitle}<br />{$x_rankimg}";}elseif(!isset($x_cookie)){$xif_user_rank="";}else{$xif_user_rank="";}return array('xif_user_name'=>$xif_user_name,'xif_user_rank'=>$xif_user_rank);}function xif_admin_founder_list(){global $db,$template,$user,$phpbb_root_path,$phpEx;$xf_lang=xir_cookie_autolang_recog();$_xf_str=xif_ext_lang($user->lang_path,$xf_lang);$x_stflst_sql="SELECT u.user_id, u.user_type, u.user_colour, u.username, u.user_avatar, u.user_avatar_type, u.user_avatar_width, u.user_avatar_height FROM ".USERS_TABLE." AS u LEFT JOIN ".GROUPS_TABLE." AS g ON g.group_id = u.group_id WHERE g.group_name REGEXP 'ADMINISTRATOR' LIMIT 0, 10";$x_result=$db->sql_query($x_stflst_sql);if(!function_exists('get_user_avatar')){include_once("{$phpbb_root_path}includes/functions_display.$phpEx");}while($x_row=$db->sql_fetchrow($x_result)){if($x_row['user_avatar']!=""){$x_avatar_dim_new=xfx_img_resizer($x_row['user_avatar_width'],$x_row['user_avatar_height'],16,16);}else{$x_admin_avatar_staff='X';}if($user->data['is_registered']&&!$user->data['is_bot']){if($x_row['user_avatar']!=""){$x_admin_avatar_staff=get_user_avatar($x_row['user_avatar'],$x_row['user_avatar_type'],$x_avatar_dim_new['res_width'],$x_avatar_dim_new['res_height']);}$x_admin_profile_staff=get_username_string('full',$x_row['user_id'],$x_row['username'],$x_row['user_colour']);}else{if($x_row['user_avatar']!=""){$x_admin_avatar_staff=get_user_avatar($x_row['user_avatar'],$x_row['user_avatar_type'],$x_avatar_dim_new['res_width'],$x_avatar_dim_new['res_height']);}$x_admin_profile_staff=get_username_string('no_profile',$x_row['user_id'],$x_row['username'],$x_row['user_colour']);}if($x_row['user_type']==3){$x_array_block="xif_founder_staff_list";$template->assign_block_vars($x_array_block,array('XIF_ADMIN_AVATAR'=>$x_admin_avatar_staff,'XIF_ADMIN_PROFILE'=>$x_admin_profile_staff,));}$x_array_block="xif_admin_staff_list";$template->assign_block_vars($x_array_block,array('XIF_ADMIN_AVATAR'=>$x_admin_avatar_staff,'XIF_ADMIN_PROFILE'=>$x_admin_profile_staff,));$template->assign_vars(array('L_XF_FOUNDER_LIST'=>$_xf_str['XF_FOUNDER_LIST'],'L_XF_ADMIN_LIST'=>$_xf_str['XF_ADMIN_LIST'],));}$db->sql_freeresult($x_result);}?>